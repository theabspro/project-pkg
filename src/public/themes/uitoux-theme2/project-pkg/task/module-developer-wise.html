<div class="content-wrap cndn-wrap">
    <div class="page-header">
        <div class="page-header-inner">
            <div class="page-header-content-left">
                <div class="page-header-content title-block">
                    <h1 class="title type-2">
                        {{$ctrl.project_version ? $ctrl.project_version.project.short_name+ "-"+ $ctrl.project_version.number : '' }}
                        ({{$ctrl.modules.length}} modules)
                    </h1>
                </div><!-- Page Header Content -->
                <filter-btn></filter-btn>
                <preset-filter-select></preset-filter-select>
            </div><!-- Page Header Content Left -->
            <div class="page-header-content-right">
                <div class="page-header-content indicator-block">
                    <div class="tab-switch1">
                        <md-tooltip md-direction="top">
                            Hide Empty Panels
                        </md-tooltip>
                        <md-switch ng-model="hide_empty_panels" aria-label="Switch 1" class="md-warn" ng-change="toggleEmptyPanels()">
                        </md-switch>
                        <input type="hidden" name="status" value="{{$ctrl.switch_value}}">
                    </div>
                </div><!-- Page Header Content -->
                <div class="page-header-content reset-block">
                    <div class="reset-wrap">
                        <button ng-shortcut="'meta+shift+r'" ng-shortcut-click class="btn btn-default">
                            <md-tooltip md-direction="top">
                                Reload Data (ctrl+shift+r)
                            </md-tooltip>
                            <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>
                        </button>
                    </div>
                </div><!-- Page Header Content -->
                <div class="page-header-content button-block">
                    <a href="javascript:;" ng-click="showModuleForm({})" class="btn btn-primary">
                        Add Module
                    </a>
                    <a href="javascript:;" ng-click="showTaskForm({}, 0, $event)" class="btn btn-primary">
                        Add Task
                    </a>
                    <a href="javascript:;" ng-click="addPhase({})" class="btn btn-primary">
                        Create Phase
                    </a>
                    <a href="#!/project-pkg/project-requirement/{{$ctrl.project_version.id}}/docs" class="btn btn-primary">
                        View Docs
                    </a>
                </div><!-- Page Header Content -->
            </div><!-- Page Header Content Right -->
        </div><!-- Page Header Inner -->
    </div><!-- Page Header -->
    <h5>
        Module & Developer Wise Task View
    </h5>
    <div class="page-main-content">
        <br />
        <div class="container-fluid" style="overflow-x: scroll;">
            <div style="width: 5000px;" class="row module_parent" dnd-list="$ctrl.modules" dnd-allowed-types="$ctrl.module_types" dnd-drop="dropModuleCallback(event,item,index)" dnd-dragover="true" dnd-droppable="true">
                <div class="col-md-3 module_child" style="width: 100%; max-width: 350px; float: left;" dnd-draggable="module" dnd-effect-allowed="move" dnd-moved="$ctrl.modules.splice($index, 1)" dnd-type="$ctrl.module_type" ng-repeat="module in $ctrl.modules" data-module_id="<% module.id  %>" id="<% $index %>">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                {{module.name}}
                                <input type="checkbox" ng-model="module.toggleSlider" class="pull-right">
                            </h3>
                            <div>
                                <div class="progress" style="margin: 0;" ng-show="!module.toggleSlider">
                                    <div class="progress-bar progress-bar-danger progress-bar-striped" role="progressbar" aria-valuenow="{{module.completed_percentage}}" aria-valuemin="0" aria-valuemax="100" style="width: {{module.completed_percentage}}%;">
                                        {{module.completed_percentage}}%
                                    </div>
                                </div>
                                <dnd-nodrag>
                                    <md-slider-container ng-disabled="isDisabled">
                                        <md-slider ng-show="module.toggleSlider" min="0" max="100" id="slider-{{module.id}}" ng-readonly="true" ng-model="module.completed_percentage" aria-label="completed percentage" class="md-warn">
                                        </md-slider>
                                    </md-slider-container>
                                </dnd-nodrag>
                            </div>
                            <div>
                                <span class="label label-danger">
                                    <md-tooltip md-direction="top">
                                        Status
                                    </md-tooltip>
                                    {{module.status.name}}
                                </span>
                                <span class="label label-success">
                                    <md-tooltip md-direction="top">
                                        Completed Percentage
                                    </md-tooltip>
                                    {{module.completed_percentage}}%
                                </span>
                                <span class="label label-info">
                                    <md-tooltip md-direction="top">
                                        Parent Modules
                                    </md-tooltip>
                                    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true">
                                    </span>
                                    {{module.parent_modules_count}}
                                </span>
                                <span class="label label-success">
                                    <md-tooltip md-direction="top">
                                        Estimated Duration
                                    </md-tooltip>
                                    {{module.duration}} hrs.
                                </span>
                                <span class="label label-warning" title="">
                                    <md-tooltip md-direction="top">
                                        Estimated Period
                                    </md-tooltip>
                                    <span class="glyphicon glyphicon-calendar" aria-hidden="true">
                                    </span>
                                    {{module.start_date}} - {{module.end_date}}
                                </span>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-sm btn-default" ng-click="showModuleForm(module)" title="Edit Module">
                                        <md-tooltip md-direction="top">
                                            Edit Module
                                        </md-tooltip>
                                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-default" ng-click="$ctrl.module=module;showTaskForm({}, 0, $event)" title="Add Task">
                                        <md-tooltip md-direction="top">
                                            Add Task to {{module.name}} Module
                                        </md-tooltip>
                                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-default" ng-click="deleteModule(module.id,$event)" ng-if="$ctrl.delete_module_permission">
                                        <md-tooltip md-direction="top">
                                            Delete Module
                                        </md-tooltip>
                                        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="panel-body" style1="height: 200px;overflow: hidden;overflow-y: scroll;">
                            <!-- UNASSIGNED TASKS OF MODULES -->
                            <div class="panel panel-default" ng-show="module.show_unassigned">
                                <div class="panel-heading">
                                    <h3 class="panel-title">
                                        <span class="glyphicon glyphicon-user" aria-hidden="true">
                                        </span>
                                        UNASSIGNED TASKS
                                        <a href="javascript:;" ng-click="$ctrl.module=module;showTaskForm({}, 0, $event)" class="pull-right">
                                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                        </a>
                                    </h3>
                                </div>
                                <ng-include src="task_card_list_template_url" ng-init="tasks = module.unassigned_tasks;date = '';status_id = '';assigned_to_id='';module_id=module.id"></ng-include>
                                <!-- <ng-include src="task_card_list_template_url" ng-init="task"></ng-include> -->
                                <!-- <task-card-list tasks="module.unassigned_tasks"></task-card-list> -->
                                <div class="panel-footer">
                                    <span class="label label-success">
                                        <md-tooltip md-direction="top">
                                            Total Tasks
                                        </md-tooltip>
                                        Tasks :
                                    </span>
                                    <span class="label label-warning">
                                        <md-tooltip md-direction="top">
                                            Estimated Hours
                                        </md-tooltip>
                                        EH :
                                    </span>
                                    <span class="label label-info">
                                        <md-tooltip md-direction="top">
                                            Actual Hours
                                        </md-tooltip>
                                        AH :
                                    </span>
                                </div>
                            </div>
                            <div class="panel panel-info" ng-repeat="(key, developer) in module.developers" ng-show="developer.show">
                                <div class="panel-heading">
                                    <h3 class="panel-title">
                                        <img ng-if="developer.profile_image" ng-src="./storage/app/public/user-profile-images/<% developer.profile_image.name %>" title="{{developer.first_name}}" class="img-circle" style="width: 50px; height: 50px; " />
                                        <span ng-if="!developer.profile_image" class="glyphicon glyphicon-user img-circle" aria-hidden="true" style="width: 50px; height: 50px">
                                        </span>
                                        {{developer.first_name}} {{developer.last_name}}
                                        <a href="javascript:;" ng-click="$ctrl.assigned_to = developer;$ctrl.module = module;showTaskForm({}, 0, $event)" class="pull-right">
                                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                        </a>
                                        <br />
                                        <span class="label label-warning">
                                            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                                            1
                                        </span>
                                        <span class="label label-danger">
                                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                            2
                                        </span>
                                        <span class="label label-success">
                                            EH : {{developer.total_estimated_hour}}
                                        </span>
                                        <span class="label label-danger">
                                            AH : {{developer.total_actual_hour}}
                                        </span>
                                    </h3>
                                </div>
                                <ng-include src="task_card_list_template_url" ng-init="tasks = developer.tasks;date = '';status_id = '';assigned_to_id=developer.id;module_id=module.id"></ng-include>
                                <div class="panel-footer">
                                    <span class="label label-success">
                                        <md-tooltip md-direction="top">
                                            Total Tasks
                                        </md-tooltip>
                                        Tasks : {{developer.tasks.length}}
                                    </span>
                                    <span class="label label-warning">
                                        <md-tooltip md-direction="top">
                                            Estimated Hours
                                        </md-tooltip>
                                        EH : {{developer.total_estimated_hour}}
                                    </span>
                                    <span class="label label-info">
                                        <md-tooltip md-direction="top">
                                            Actual Hours
                                        </md-tooltip>
                                        AH : {{developer.total_actual_hour}}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="panel-footer">
                            &nbsp;
                        </div>
                    </div>
                </div><!-- Column -->
            </div><!-- Row -->
        </div><!-- Container -->
    </div><!-- Page Main Content -->
</div><!-- Content Wrap -->
<module-modal-form module="$ctrl.module"></module-modal-form>
<task-modal-form task="$ctrl.task"></task-modal-form>
<!-- Filter Modal -->
<div class="modal fade filter" id="filter-modal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close ripple" data-dismiss="modal" aria-label="Close"><i class="icon ion-md-close"></i></button>
                <h5 class="modal-title">
                    Filter
                </h5>
            </div><!-- Modal Header -->
            <div class="modal-body">
                <div class="modal-form">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="separate-form-group">
                                <label>
                                    Task Status
                                </label>
                                <ui-select ng-model="$ctrl.filter.task_status" theme="select2">
                                    <ui-select-match placeholder="Select Task Status">
                                        {{$select.selected.name || $select.selected}}
                                    </ui-select-match>
                                    <ui-select-choices repeat="i in $ctrl.task_status_list | propsFilter: {name: $select.search}">
                                        <div ng-bind-html="i.name | highlight: $select.search"></div>
                                    </ui-select-choices>
                                </ui-select>
                            </div><!-- Field -->
                        </div><!-- Column -->
                        <div class="col-md-6">
                            <button type="button" class="btn btn-rose" ng-click="reset_filter()">
                                Reset Filter
                            </button>
                        </div>
                        <preset-filter-form></preset-filter-form>
                    </div><!-- Row -->
                </div><!-- Modal Form -->
            </div><!-- Modal Body -->
        </div><!-- Modal Content -->
    </div><!-- Modal Dialog -->
</div><!-- Modal -->
<!-- Modal -->
<div class="modal fade alert-modal failure" id="delete_task" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">ARE YOU SURE?</h4>
            </div>
            <div class="modal-body">
                <h5>Delete</h5>
                <p>You can’t retrive the data again, Are you sure you want to delete? </p>
                <input type="hidden" name="task_id" id="task_id" value="">
                <button class="btn btn-grey" data-dismiss="modal" aria-label="Close">Cancel</button>
                <button class="btn btn-rose" ng-click="deleteTaskConfirm()" type="button" data-dismiss="modal" aria-label="Close">Yes</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<!-- Modal -->
<div class="modal fade alert-modal failure" id="delete_module" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">ARE YOU SURE?</h4>
            </div>
            <div class="modal-body">
                <h5>Delete</h5>
                <p>You can’t retrive the data again, Are you sure you want to delete? </p>
                <input type="hidden" name="module_id" id="module_id" value="">
                <button class="btn btn-grey" data-dismiss="modal" aria-label="Close">Cancel</button>
                <button class="btn btn-rose" ng-click="deleteModuleConfirm()" type="button" data-dismiss="modal" aria-label="Close">Yes</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
